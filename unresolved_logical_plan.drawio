<mxfile host="app.diagrams.net" modified="2022-04-04T06:15:53.204Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36" etag="mcqlLaZxgsHO9hUyUflo" version="17.4.0" type="github">
  <diagram id="_TAUJCwC3Z414NcdCWBq" name="Page-1">
    <mxGraphModel dx="2616" dy="1154" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="T3wzXR9VALe59u5OGyin-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=default;fontFamily=Comic Sans MS;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-1" target="T3wzXR9VALe59u5OGyin-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-1" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;plan = parsePlan(&quot;SELECT A,B FROM TESTA&quot;)&lt;/span&gt;&lt;span style=&quot;font-size: 9.8pt&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="68" y="171" width="328" height="50" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=11;fontColor=#A680B8;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-2" target="T3wzXR9VALe59u5OGyin-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-2" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;ParseDriver.parse()&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="152.5" y="261" width="159" height="50" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-4" value="词法语法解析" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="71" y="271" width="74" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=11;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-5" target="T3wzXR9VALe59u5OGyin-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-5" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp;ParseDriver.parsePlan(){&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;parser.singleStatement()&lt;/span&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;astBuilder.visitSingleStatement()&lt;/span&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp;}&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="111.19" y="350" width="241.62" height="82" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-14" target="T3wzXR9VALe59u5OGyin-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-14" value="&lt;div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitSingleStatement(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;visit(ctx.statement)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;align=center;" vertex="1" parent="1">
          <mxGeometry x="100.5" y="468" width="263" height="70" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-18" target="T3wzXR9VALe59u5OGyin-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-18" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AbstractParseTreeVisitor.visit(ParseTree tree){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;tree.accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="401" y="471" width="305" height="64" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-31" value="&lt;h1 style=&quot;font-size: 10px&quot;&gt;生成未解析的逻辑执行计划&lt;/h1&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;1. 生成AstTree&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;2. astBuilder对象去访问Tree&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" vertex="1" parent="1">
          <mxGeometry x="-58" y="358" width="187" height="66" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-34" value="AstBuilder的visit方法继承自AbstractParseTreeVisitor的visit" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="443" y="421" width="192" height="57" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-35" target="T3wzXR9VALe59u5OGyin-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-35" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseParser.StatementDefaultContext(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;accept(visitor){&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;visitor.visitStatementDefault(this)&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="392" y="580" width="323.5" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-37" value="会调用当前参数的accept方法&lt;br&gt;如当前为StatementDefaultContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="719" y="584" width="213" height="53" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-38" target="T3wzXR9VALe59u5OGyin-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-38" value="&lt;div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseBaseVisitor.visitStatementDefault(ctx){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; this.visitChildren(ctx)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="392" y="696" width="323.5" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-40" value="重点：若当前节点非重要节点，spark不会重写方法，而是直接调用&lt;br&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="726" y="699.5" width="236" height="64" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-41" target="T3wzXR9VALe59u5OGyin-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-41" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitChildren(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; node.getChild(0).accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="123.25" y="794" width="217.5" height="62" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-44" value="重点：spark进行重写，调用孩子节点的accept()方法。实现从&amp;nbsp;&lt;br&gt;&lt;span&gt;StatementDefaultContext -&amp;gt; QueryContext&lt;br&gt;下一个节点的变化&lt;/span&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-145" y="789.5" width="262.75" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-45" target="T3wzXR9VALe59u5OGyin-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-45" value="&lt;div&gt;SqlBaseBaseParser.QueryContext {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; accept(visitor){&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; visitor.visitQuery(this)&lt;/div&gt;&lt;div&gt;}}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="435" y="792" width="232.25" height="66" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-47" value="&lt;div&gt;AstBuilder.visitQuery {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; query = plan(ctx.queryTerm)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // Apply CTEs ...&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;fontColor=default;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="111.19" y="935" width="227.81" height="65" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-49" value="重点：query下有两个节点，spark进行重写&lt;br&gt;此处会处理CTEs&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-145" y="926" width="262.75" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-50" value="调用子节点的accept方法，子节点为QueryContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="686" y="798.5" width="213" height="53" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
