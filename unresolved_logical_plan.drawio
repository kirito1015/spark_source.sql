<mxfile host="app.diagrams.net" modified="2022-04-04T11:04:20.705Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36" etag="un5FO4l0_UhDqsSoESqh" version="17.4.0" type="github">
  <diagram id="_TAUJCwC3Z414NcdCWBq" name="Page-1">
    <mxGraphModel dx="2218" dy="898" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="T3wzXR9VALe59u5OGyin-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=default;fontFamily=Comic Sans MS;" parent="1" source="T3wzXR9VALe59u5OGyin-1" target="T3wzXR9VALe59u5OGyin-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-1" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;plan = parsePlan(&quot;SELECT A,B FROM TESTA&quot;)&lt;/span&gt;&lt;span style=&quot;font-size: 9.8pt&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="68" y="195" width="328" height="50" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=11;fontColor=#A680B8;" parent="1" source="T3wzXR9VALe59u5OGyin-2" target="T3wzXR9VALe59u5OGyin-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-2" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;ParseDriver.parse()&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="152.5" y="274" width="159" height="50" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-4" value="词法语法解析" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="71" y="284" width="74" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=11;fontColor=#6666FF;" parent="1" source="T3wzXR9VALe59u5OGyin-5" target="T3wzXR9VALe59u5OGyin-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-5" value="&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp;ParseDriver.parsePlan(){&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;parser.singleStatement()&lt;/span&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;astBuilder.visitSingleStatement()&lt;/span&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp;}&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=0;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;align=left;" parent="1" vertex="1">
          <mxGeometry x="111.19" y="350" width="241.62" height="82" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" parent="1" source="T3wzXR9VALe59u5OGyin-14" target="T3wzXR9VALe59u5OGyin-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-14" value="&lt;div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitSingleStatement(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;visit(ctx.statement)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;align=center;" parent="1" vertex="1">
          <mxGeometry x="117.75" y="459" width="227.5" height="68" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" parent="1" source="T3wzXR9VALe59u5OGyin-18" target="T3wzXR9VALe59u5OGyin-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-18" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AbstractParseTreeVisitor.visit(ParseTree tree){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;tree.accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="399.6" y="461" width="305" height="64" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-31" value="&lt;h1 style=&quot;font-size: 10px&quot;&gt;生成未解析的逻辑执行计划&lt;/h1&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;1. 生成AstTree&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;2. astBuilder对象去访问Tree&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" parent="1" vertex="1">
          <mxGeometry x="-59.33" y="369" width="187" height="66" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-34" value="AstBuilder的visit方法继承自AbstractParseTreeVisitor的visit" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="461" y="409" width="192" height="57" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" parent="1" source="T3wzXR9VALe59u5OGyin-35" target="T3wzXR9VALe59u5OGyin-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-35" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseParser.StatementDefaultContext{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;accept(visitor){&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;visitor.visitStatementDefault(this)&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="390.35" y="554" width="323.5" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-37" value="会调用当前参数的accept方法&lt;br&gt;如当前为StatementDefaultContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="719" y="558" width="213" height="53" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;exitX=0.499;exitY=0.981;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="T3wzXR9VALe59u5OGyin-38" target="T3wzXR9VALe59u5OGyin-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="552.1111111111109" y="728" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="552" y="735" />
              <mxPoint x="236" y="735" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-38" value="&lt;div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseBaseVisitor.visitStatementDefault(ctx){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; this.visitChildren(ctx)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="390.35" y="647" width="323.5" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-40" value="若当前节点非重要节点，spark不会重写方法，而是直接调用&lt;br&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="722" y="655" width="199" height="63" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;" parent="1" source="T3wzXR9VALe59u5OGyin-41" target="T3wzXR9VALe59u5OGyin-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-41" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitChildren(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; node.getChild(0).accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="139.59" y="755" width="191.75" height="62" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-44" value="进行重写，调用孩子节点accept()方法实现从&amp;nbsp;&lt;br&gt;&lt;span&gt;StatementDefaultContext -&amp;gt; QueryContext&lt;br&gt;&lt;/span&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="-123.16" y="750.5" width="262.75" height="71" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Comic Sans MS;fontSize=10;fontColor=#6666FF;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="T3wzXR9VALe59u5OGyin-45" target="T3wzXR9VALe59u5OGyin-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-45" value="&lt;div&gt;SqlBaseBaseParser.QueryContext {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; accept(visitor){&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; visitor.visitQuery(this)&lt;/div&gt;&lt;div&gt;}}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="437.63" y="753" width="232.25" height="66" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="T3wzXR9VALe59u5OGyin-47" target="bS2-JoX9ewdRHK1aLQZ--1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-47" value="&lt;div&gt;AstBuilder.visitQuery {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; query = plan(ctx.queryTerm)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // Apply CTEs ...&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=0;fillColor=#f8cecc;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="139.59" y="861.5" width="183.81" height="58" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-49" value="query下有两个节点，spark进行重写&lt;br&gt;此处会处理CTEs&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#99004D;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="-67.41" y="859" width="203.16" height="56.5" as="geometry" />
        </mxCell>
        <mxCell id="T3wzXR9VALe59u5OGyin-50" value="调用子节点的accept方法，子节点为QueryContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="676" y="759.5" width="213" height="53" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--1" target="bS2-JoX9ewdRHK1aLQZ--4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--1" value="SqlBaseParser.QueryContext{&lt;br&gt;queryTerm(){&lt;br&gt;this.getRuleContext&lt;br&gt;}}" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="450.91" y="857.75" width="196" height="65.5" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--3" value="QueryContext里先调用queryTerm方法，queryTerm里执行的是getRuleContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="656" y="861.5" width="213" height="53" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--4" target="bS2-JoX9ewdRHK1aLQZ--7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="549" y="1011" />
              <mxPoint x="245" y="1011" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--4" value="ParserRuleContext.getRuleContext(ctx){&lt;br&gt;getChild()&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="425.90999999999997" y="941.5" width="246" height="56" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--6" value="实际上执行getChild，此时从&lt;br&gt;QueryContext -&amp;gt; QueryTermDefaultContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="676" y="935" width="259" height="69" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--7" target="bS2-JoX9ewdRHK1aLQZ--10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--7" value="AstBuilder.plan(tree) = typedVisit(tree)" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="127.67" y="1031" width="237" height="44" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--9" value="ctx.queryTerm生成后，执行plan方法，plan里实际调用是typedVisit()" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-67.41" y="1031" width="189.9" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#FF0000;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--10" target="bS2-JoX9ewdRHK1aLQZ--13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--10" value="AstBuilder.typedVisit(ctx){&lt;br&gt;ctx.accept(this)&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=none;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="127.67" y="1109" width="238.33" height="48" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--12" value="typedVisit里实际执行的也是当前对象多accept方法" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-72.15" y="1107" width="189.9" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#FF0000;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--13" target="bS2-JoX9ewdRHK1aLQZ--15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--13" value="&lt;div&gt;SqlBaseParser.QueryTermDefaultContext{&lt;/div&gt;&lt;div&gt;accept(visitor){&lt;/div&gt;&lt;div&gt;visitor.visitQueryTermDefault(this)&lt;/div&gt;&lt;div&gt;}}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="415" y="1100" width="284" height="66" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#6666FF;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--15" target="bS2-JoX9ewdRHK1aLQZ--19">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="556" y="1265" />
              <mxPoint x="232" y="1265" />
              <mxPoint x="232" y="1283" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--15" value="&lt;div&gt;SqlBaseBaseVisitor.visitQueryTermDefault(ctx){&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; this.visitChildren(ctx)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="416" y="1189" width="282" height="57" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--17" value="当前对象为QueryTermDefaultContext，调用对象的accept方法" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="710" y="1104" width="231" height="53" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--18" value="未重写，直接调用&lt;br&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="696.75" y="1200" width="131.5" height="41" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#6666FF;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--19" target="bS2-JoX9ewdRHK1aLQZ--21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--19" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitChildren(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; node.getChild(0).accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="135.75" y="1283" width="191.81" height="62" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#6666FF;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--21" target="bS2-JoX9ewdRHK1aLQZ--24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--21" value="&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseParser.QueryPrimaryDefaultContext{&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;accept(visitor){&lt;br&gt;visitQueryPrimaryDefault(this)&lt;br&gt;}}&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="414.4" y="1281" width="292.21" height="66" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--23" value="&lt;span&gt;调用子节点accept方法QueryTermDefaultContext -&amp;gt; QueryPrimaryDefaultContext&lt;br&gt;&lt;/span&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#FF0000;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-79.04999999999998" y="1288" width="202.49" height="52" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#876E54;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--24" target="bS2-JoX9ewdRHK1aLQZ--28">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="561" y="1457" />
              <mxPoint x="231" y="1457" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--24" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseBaseVisitor.visitQueryPrimaryDefault(ctx){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; &amp;nbsp; this.visitChildren(ctx)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="399" y="1374" width="323" height="66" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--27" value="同上&lt;br&gt;&lt;div class=&quot;okr-block-clipboard&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;labelBackgroundColor=none;sketch=1;fontSize=11;fontColor=#6666FF;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="719" y="1296" width="69" height="36" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#876E54;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--28" target="bS2-JoX9ewdRHK1aLQZ--30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--28" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitChildren(){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; node.getChild(0).accept(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="135.3" y="1481" width="191" height="62" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#876E54;" edge="1" parent="1" source="bS2-JoX9ewdRHK1aLQZ--30" target="bS2-JoX9ewdRHK1aLQZ--32">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="564" y="1573" />
              <mxPoint x="235" y="1573" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--30" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;SqlBaseParser.RegularQuerySpecificationContext{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;accept(visitor){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;visitRegularQuerySpecification(this)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#d5e8d4;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="399.59999999999997" y="1477.5" width="328.35" height="69" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--32" value="&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;AstBuilder.visitRegularQuerySpecification(ctx){&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; visitFromClause(ctx.fromClause)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;&amp;nbsp; withSelectQuerySpecification(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 13.0667px&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;sketch=0;fillColor=#f8cecc;shadow=0;glass=0;labelBackgroundColor=none;fontFamily=Comic Sans MS;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="70.65" y="1606" width="312.35" height="69" as="geometry" />
        </mxCell>
        <mxCell id="bS2-JoX9ewdRHK1aLQZ--35" value="&lt;h1 style=&quot;font-size: 11px&quot;&gt;spark重写的重要节点&lt;/h1&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;1. 访问 from 子句&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;2. 访问其他子句：&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;select&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;lateralview&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;where&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;aggregation&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;having等&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;sketch=0;fontColor=#99004D;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="-67.41" y="1596" width="133" height="129" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
